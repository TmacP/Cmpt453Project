-- test.script
local socket = require("socket")

function init(self)
	-- print("test.script initialized on /main/network")
	-- Create a UDP socket
	self.udp = assert(socket.udp())

	-- Set the server address and port
	local server_ip = "206.51.242.248"  -- Update to your Fly.io server IP
	local server_port = 12345          -- Update to your Fly.io server port

	-- Connect to the server
	self.udp:setpeername(server_ip, server_port)

	-- Set a timeout for receiving data (in seconds)
	self.udp:settimeout(2)
end

function on_message(self, message_id, message, sender)
	if message_id == hash("start_udp") then
		print("test.script: called on_message()")
		-- Send a message to the server
		local message = "Hello from Defold!"
		self.udp:send(message)
		print("Message sent to server:", message)

		-- Receive the echoed message from the server
		local response, err = self.udp:receive()
		if response then
			print("Received from server:", response)
		else
			print("Error receiving response:", err)
		end
	end
end

function final(self)
	-- Close the UDP socket when the script is done
	if self.udp then
		self.udp:close()
	end
end
